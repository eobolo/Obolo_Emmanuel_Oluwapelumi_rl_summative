<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartDelivery 3D Visualization</title>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
        }
        
        #info {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 5px;
            font-family: Arial, sans-serif;
            max-width: 300px;
            max-height: 80vh;
            overflow-y: auto;
            z-index: 1000;
        }
        
        .status {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .error {
            color: #f44336;
        }
        
        .data-item {
            margin: 5px 0;
            font-size: 12px;
        }
        
        .data-label {
            color: #ccc;
        }
        
        .data-value {
            color: #4CAF50;
            font-weight: bold;
        }
        
        #controls {
            position: absolute;
            top: 10px;
            right: 10px;
            color: white;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 5px;
            z-index: 1000;
        }
        
        .control-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 2px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .control-button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <div id="info">
        <h3>SmartDelivery 3D</h3>
        <div id="status">Connecting...</div>
        <div id="data">Waiting for data...</div>
        <div id="details"></div>
    </div>
    
    <div id="controls">
        <button class="control-button" onclick="toggleWireframe()">Wireframe</button>
        <button class="control-button" onclick="resetCamera()">Reset Camera</button>
        <button class="control-button" onclick="toggleAnimation()">Pause/Play</button>
    </div>

    <script>
        // Global variables
        let scene, camera, renderer, controls;
        let school = null, truck = null, textbooks = [], guides = [];
        let animationPaused = false;
        let wireframeMode = false;
        let deliveryPhase = 'idle';
        let deliveryProgress = 0.0;
        let truckTargetPosition = {x: 0, y: 1, z: 0};
        let truckStartPosition = {x: -50, y: 1, z: 0};
        
        // Initialize Three.js
        function init() {
            // Scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e); // Dark blue-gray background
            
            // Camera
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 30, 50);
            camera.lookAt(0, 0, 0);
            
            // Renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('container').appendChild(renderer.domElement);
            
            // Lighting - Brighter for better visibility on dark background
            const ambientLight = new THREE.AmbientLight(0x606060, 1.2); // Brighter ambient light
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1.5); // Brighter directional light
            directionalLight.position.set(50, 50, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // Ground plane - Darker ground
            const groundGeometry = new THREE.PlaneGeometry(200, 200);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x2d4a3e }); // Dark green ground
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Grid helper
            const gridHelper = new THREE.GridHelper(200, 20, 0x666666, 0x444444);
            scene.add(gridHelper);
            
            // Animation loop
            animate();
        }
        
        function animate() {
            requestAnimationFrame(animate);
            
            if (!animationPaused) {
                // Animate truck delivery
                animateTruckDelivery();
                
                // Animate textbooks and guides
                [...textbooks, ...guides].forEach(item => {
                    if (item.mesh) {
                        if (item.data.type === 'header') {
                            // Make headers always face the camera
                            item.mesh.lookAt(camera.position);
                        } else {
                            // Rotate other objects
                            item.mesh.rotation.y += 0.01;
                        }
                    }
                });
            }
            
            renderer.render(scene, camera);
        }
        
        function animateTruckDelivery() {
            if (!truck || !truck.mesh) return;
            
            switch (deliveryPhase) {
                case 'approaching':
                    deliveryProgress += 0.02;
                    if (deliveryProgress >= 1.0) {
                        deliveryProgress = 1.0;
                        deliveryPhase = 'delivering';
                        deliveryProgress = 0.0;
                    }
                    // Move truck towards school
                    truck.mesh.position.x = truckStartPosition.x + (truckTargetPosition.x - truckStartPosition.x) * deliveryProgress;
                    truck.mesh.position.z = truckStartPosition.z + (truckTargetPosition.z - truckStartPosition.z) * deliveryProgress;
                    break;
                    
                case 'delivering':
                    deliveryProgress += 0.01;
                    if (deliveryProgress >= 1.0) {
                        deliveryProgress = 1.0;
                        deliveryPhase = 'returning';
                        deliveryProgress = 0.0;
                        console.log('Delivery completed, truck returning');
                        
                        // Mark delivery as completed - resources should already be updated in the state
                        if (truck.data.action) {
                            console.log('Delivery action completed:', truck.data.action);
                        }
                    }
                    // Truck stays at school during delivery
                    break;
                    
                case 'returning':
                    deliveryProgress += 0.02;
                    if (deliveryProgress >= 1.0) {
                        deliveryProgress = 1.0;
                        deliveryPhase = 'idle';
                        deliveryProgress = 0.0;
                    }
                    // Move truck back to start position
                    truck.mesh.position.x = truckTargetPosition.x + (truckStartPosition.x - truckTargetPosition.x) * deliveryProgress;
                    truck.mesh.position.z = truckTargetPosition.z + (truckStartPosition.z - truckTargetPosition.z) * deliveryProgress;
                    break;
                    
                case 'idle':
                default:
                    // Truck stays at start position
                    truck.mesh.position.x = truckStartPosition.x;
                    truck.mesh.position.z = truckStartPosition.z;
                    break;
            }
        }
        
        function createSchool(data) {
            const geometry = new THREE.BoxGeometry(15, 10, 15);
            const material = new THREE.MeshLambertMaterial({ 
                color: data.urgencyColor || 0x00ff00,
                emissive: 0x222222  // Add emissive for brightness
            });
            const mesh = new THREE.Mesh(geometry, material);
            
            mesh.position.set(data.position.x, data.position.y + 5, data.position.z);
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            
            // Add school label with detailed information
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 128;
            context.fillStyle = 'white';
            context.font = '20px Arial';
            context.fillText(data.name, 10, 25);
            context.fillText(`${data.students} students`, 10, 50);
            
            // Add textbook counts
            if (data.textbooks) {
                let textbookText = '';
                if (data.textbooks.kiny > 0) textbookText += `KINY:${data.textbooks.kiny} `;
                if (data.textbooks.eng > 0) textbookText += `ENG:${data.textbooks.eng} `;
                if (data.textbooks.math > 0) textbookText += `MATH:${data.textbooks.math}`;
                context.fillText(textbookText, 10, 75);
            }
            
            // Add guide counts
            if (data.guides) {
                let guideText = '';
                if (data.guides.kiny > 0) guideText += `KINY:${data.guides.kiny} `;
                if (data.guides.eng > 0) guideText += `ENG:${data.guides.eng} `;
                if (data.guides.math > 0) guideText += `MATH:${data.guides.math}`;
                context.fillText(guideText, 10, 100);
            }
            
            const texture = new THREE.CanvasTexture(canvas);
            const labelMaterial = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
            const labelGeometry = new THREE.PlaneGeometry(30, 8);
            const label = new THREE.Mesh(labelGeometry, labelMaterial);
            label.position.set(0, 15, 0);
            mesh.add(label);
            
            return mesh;
        }
        
        function createTruck(data) {
            const geometry = new THREE.BoxGeometry(8, 4, 12);
            const material = new THREE.MeshLambertMaterial({ 
                color: 0x4169E1,
                emissive: 0x111111  // Add emissive for brightness
            });
            const mesh = new THREE.Mesh(geometry, material);
            
            mesh.position.set(data.position.x, data.position.y + 2, data.position.z);
            mesh.castShadow = true;
            
            // Add truck label
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 64;
            context.fillStyle = 'white';
            context.font = '16px Arial';
            context.fillText(data.name, 10, 25);
            context.fillText(data.status, 10, 45);
            
            const texture = new THREE.CanvasTexture(canvas);
            const labelMaterial = new THREE.MeshBasicMaterial({ map: texture, transparent: true });
            const labelGeometry = new THREE.PlaneGeometry(20, 5);
            const label = new THREE.Mesh(labelGeometry, labelMaterial);
            label.position.set(0, 8, 0);
            mesh.add(label);
            
            return mesh;
        }
        
        function createTextbook(data) {
            const geometry = new THREE.BoxGeometry(1, 0.2, 1.5);
            const material = new THREE.MeshLambertMaterial({ 
                color: data.color || 0x8B4513,
                emissive: 0x222222  // Add emissive for brightness
            });
            const mesh = new THREE.Mesh(geometry, material);
            
            mesh.position.set(data.position.x, data.position.y + 0.1, data.position.z);
            mesh.castShadow = true;
            
            return mesh;
        }
        
        function createGuide(data) {
            const geometry = new THREE.BoxGeometry(0.8, 0.15, 1.2);
            const material = new THREE.MeshLambertMaterial({ 
                color: data.color || 0xFFD700,
                emissive: 0x222222  // Add emissive for brightness
            });
            const mesh = new THREE.Mesh(geometry, material);
            
            mesh.position.set(data.position.x, data.position.y + 0.075, data.position.z);
            mesh.castShadow = true;
            
            return mesh;
        }
        
        function createHeader(data) {
            // Create a text label for the header
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 512;
            canvas.height = 64;
            context.fillStyle = data.color || '#FFFFFF';
            context.font = `${data.fontSize || 16}px Arial`;
            context.fillText(data.text, 10, 40);
            
            const texture = new THREE.CanvasTexture(canvas);
            const labelMaterial = new THREE.MeshBasicMaterial({ 
                map: texture, 
                transparent: true,
                side: THREE.DoubleSide
            });
            const labelGeometry = new THREE.PlaneGeometry(20, 2.5);
            const label = new THREE.Mesh(labelGeometry, labelMaterial);
            
            label.position.set(data.position.x, data.position.y, data.position.z);
            
            // Make header always face the camera
            label.userData = { type: 'header', originalPosition: data.position };
            
            return label;
        }
        
        function updateVisualization(data) {
            console.log('Starting updateVisualization for ONE school:', data);
            
            // Clear existing objects
            if (school && school.mesh) scene.remove(school.mesh);
            if (truck && truck.mesh) scene.remove(truck.mesh);
            textbooks.forEach(book => {
                if (book.mesh) scene.remove(book.mesh);
            });
            guides.forEach(guide => {
                if (guide.mesh) scene.remove(guide.mesh);
            });
            
            school = null;
            truck = null;
            textbooks = [];
            guides = [];
            
            // Create ONE school
            if (data.school) {
                console.log('Creating school:', data.school);
                const schoolMesh = createSchool(data.school);
                scene.add(schoolMesh);
                school = { data: data.school, mesh: schoolMesh };
            }
            
            // Create delivery truck
            if (data.truck) {
                console.log('Creating truck:', data.truck);
                const truckMesh = createTruck(data.truck);
                scene.add(truckMesh);
                truck = { data: data.truck, mesh: truckMesh };
                
                // Set delivery animation parameters
                if (data.truck.action) {
                    deliveryPhase = 'approaching';
                    deliveryProgress = 0.0;
                    console.log('Starting delivery animation');
                }
            }
            
            // Create textbooks and headers at the back of the school
            if (data.textbooks && data.textbooks.length > 0) {
                console.log('Creating textbooks:', data.textbooks.length);
                data.textbooks.forEach((bookData, index) => {
                    console.log('Creating textbook', index, ':', bookData);
                    
                    if (bookData.type === 'header') {
                        // Create header label
                        const headerMesh = createHeader(bookData);
                        scene.add(headerMesh);
                        textbooks.push({ data: bookData, mesh: headerMesh });
                    } else {
                        // Create textbook object
                        const bookMesh = createTextbook(bookData);
                        scene.add(bookMesh);
                        textbooks.push({ data: bookData, mesh: bookMesh });
                    }
                });
            }
            
            // Create guides and headers at the front of the school
            if (data.guides && data.guides.length > 0) {
                console.log('Creating guides:', data.guides.length);
                data.guides.forEach((guideData, index) => {
                    console.log('Creating guide', index, ':', guideData);
                    
                    if (guideData.type === 'header') {
                        // Create header label
                        const headerMesh = createHeader(guideData);
                        scene.add(headerMesh);
                        guides.push({ data: guideData, mesh: headerMesh });
                    } else {
                        // Create guide object
                        const guideMesh = createGuide(guideData);
                        scene.add(guideMesh);
                        guides.push({ data: guideData, mesh: guideMesh });
                    }
                });
            }
            
            console.log('updateVisualization completed. Objects:', {
                school: school ? 1 : 0,
                truck: truck ? 1 : 0,
                textbooks: textbooks.length,
                guides: guides.length
            });
        }
        
        // Control functions
        function toggleWireframe() {
            wireframeMode = !wireframeMode;
            const objects = [...schools, ...trucks, ...textbooks, ...guides];
            objects.forEach(obj => {
                if (obj.mesh && obj.mesh.material) {
                    obj.mesh.material.wireframe = wireframeMode;
                }
            });
        }
        
        function resetCamera() {
            camera.position.set(0, 50, 100);
            camera.lookAt(0, 0, 0);
        }
        
        function toggleAnimation() {
            animationPaused = !animationPaused;
        }
        
        // Socket.IO connection
        const socket = io();
        
        socket.on('connect', function() {
            console.log('Socket connected!');
            document.getElementById('status').innerHTML = '<span class="status">Connected!</span>';
            
            // Request the latest state
            console.log('Requesting latest state...');
            socket.emit('request_state');
        });
        
        socket.on('disconnect', function() {
            console.log('Socket disconnected!');
            document.getElementById('status').innerHTML = '<span class="error">Disconnected!</span>';
        });
        
        socket.on('connect_error', function(error) {
            console.error('Connection error:', error);
            document.getElementById('status').innerHTML = '<span class="error">Connection Error!</span>';
        });
        
        socket.on('connected', function(data) {
            console.log('Received connected event:', data);
        });
        
        socket.on('state_update', function(data) {
            console.log('Received state:', data);
            
            // Check for errors in the data
            if (data.error) {
                console.error('Error in state data:', data.error);
                document.getElementById('data').innerHTML = '<span class="error">Error: ' + data.error + '</span>';
                return;
            }
            
            // Validate data structure
            if (!data || typeof data !== 'object') {
                console.error('Invalid data received:', data);
                document.getElementById('data').innerHTML = '<span class="error">Invalid data received</span>';
                return;
            }
            
            // Update the data display
            document.getElementById('data').innerHTML = '<span class="status">Data received!</span>';
            
            // Debug: Log the data structure
            console.log('Data keys:', Object.keys(data));
            console.log('Schools:', data.schools);
            console.log('Textbooks:', data.textbooks);
            console.log('Trucks:', data.trucks);
            console.log('Guides:', data.guides);
            
            // Update 3D visualization
            try {
                updateVisualization(data);
                console.log('3D visualization updated successfully');
                
            } catch (error) {
                console.error('Error updating 3D visualization:', error);
            }
            
            // Show detailed information
            let detailsHtml = `<h4>Target School Data:</h4>`;
            
            // Add update timestamp
            if (data.updateTime) {
                detailsHtml += `<div style="font-size: 11px; color: #888; margin-bottom: 10px;">Last Update: ${data.updateTime} ${data.hasActiveAction ? '[DELIVERY]' : '[IDLE]'}</div>`;
            }
            
            if (data.environment) {
                detailsHtml += `
                    <div class="data-item">
                        <span class="data-label">Students:</span> 
                        <span class="data-value">${data.environment.numStudents || 0}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Urgency Level:</span> 
                        <span class="data-value">${data.environment.urgencyLevel === 0 ? 'Low' : data.environment.urgencyLevel === 1 ? 'Medium' : data.environment.urgencyLevel === 2 ? 'High' : 'Unknown'}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Grant Usage:</span> 
                        <span class="data-value">${data.environment.grantUsage || 0}%</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Time Since Delivery:</span> 
                        <span class="data-value">${data.environment.timeSinceLastDelivery || 0} days</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Delivery Success History:</span> 
                        <span class="data-value">${data.environment.deliverySuccessHistory === 0 ? 'Low' : data.environment.deliverySuccessHistory === 1 ? 'Medium' : 'High'}</span>
                </div>
                    <div class="data-item">
                        <span class="data-label">Infrastructure Rating:</span> 
                        <span class="data-value">${data.environment.infrastructureRating || 0}/100</span>
            </div>
                    <div class="data-item">
                        <span class="data-label">Location Type:</span> 
                        <span class="data-value">${data.environment.locationType === 0 ? 'Rural' : 'Urban'}</span>
                    </div>
                `;
            }
            
            if (data.school) {
                detailsHtml += '<h4>Current Resources:</h4>';
                
                // Show delivery status if active
                const deliveryStatus = data.school.hasActiveDelivery ? ' (DELIVERY IN PROGRESS)' : '';
                const bgColor = data.school.hasActiveDelivery ? 'rgba(255,165,0,0.2)' : 'rgba(255,255,255,0.1)';
                
                detailsHtml += `
                    <div class="data-item" style="margin-bottom: 10px; padding: 5px; background: ${bgColor}; border-radius: 3px;">
                        <div style="font-weight: bold; color: #4CAF50;">${data.school.name}${deliveryStatus}</div>
                        <div>Students: ${data.school.students || 0}</div>
                        <div>Textbooks: KINY:${data.school.textbooks?.kiny || 0} | ENG:${data.school.textbooks?.eng || 0} | MATH:${data.school.textbooks?.math || 0}</div>
                        <div>Guides: KINY:${data.school.guides?.kiny || 0} | ENG:${data.school.guides?.eng || 0} | MATH:${data.school.guides?.math || 0}</div>
                        
                        ${data.school.hasActiveDelivery && data.school.originalTextbooks ? `
                        <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.3);">
                            <div style="font-size: 11px; color: #ccc;">Before Delivery:</div>
                            <div style="font-size: 11px;">Textbooks: KINY:${data.school.originalTextbooks?.kiny || 0} | ENG:${data.school.originalTextbooks?.eng || 0} | MATH:${data.school.originalTextbooks?.math || 0}</div>
                            <div style="font-size: 11px;">Guides: KINY:${data.school.originalGuides?.kiny || 0} | ENG:${data.school.originalGuides?.eng || 0} | MATH:${data.school.originalGuides?.math || 0}</div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }
            
            if (data.truck) {
                detailsHtml += '<h4>Delivery Status:</h4>';
                detailsHtml += `
                    <div class="data-item">
                        <span class="data-label">Truck Status:</span> 
                        <span class="data-value">${data.truck.status}</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Delivery Phase:</span> 
                        <span class="data-value">${data.truck.deliveryPhase}</span>
                    </div>
                `;
            }
            
            if (data.action) {
                detailsHtml += '<h4 style="color: #FFA500;">Current Action (Delivery in Progress):</h4>';
                detailsHtml += `
                    <div style="background: rgba(255,165,0,0.2); padding: 8px; border-radius: 5px; margin-bottom: 10px;">
                        <div class="data-item">
                            <span class="data-label">Textbooks Delivering:</span> 
                            <span class="data-value" style="color: #FFA500;">KINY:${data.action[0] || 0} | ENG:${data.action[1] || 0} | MATH:${data.action[2] || 0}</span>
                        </div>
                        <div class="data-item">
                            <span class="data-label">Guides Delivering:</span> 
                            <span class="data-value" style="color: #FFA500;">KINY:${data.action[3] || 0} | ENG:${data.action[4] || 0} | MATH:${data.action[5] || 0}</span>
                        </div>
                        <div style="font-size: 11px; color: #FFA500; margin-top: 5px; font-style: italic;">
                            Resources shown above are being added to the school!
                        </div>
                    </div>
                `;
            }
            
            if (data.textbooks && data.textbooks.length > 0) {
                detailsHtml += '<h4>Textbooks in School (Visual vs Actual):</h4>';
                const subjects = {};
                data.textbooks.forEach(book => {
                    if (book.type !== 'header') {  // Skip header objects
                        if (!subjects[book.subject]) {
                            subjects[book.subject] = {
                                visual: 0,
                                total: book.totalCount || 0
                            };
                        }
                        subjects[book.subject].visual++;
                    }
                });
                Object.entries(subjects).forEach(([subject, info]) => {
                    detailsHtml += `
                        <div class="data-item">
                            <span class="data-label">${subject.toUpperCase()}:</span> 
                            <span class="data-value">${info.visual} shown / ${info.total} total</span>
                </div>
                    `;
                });
            }
            
            if (data.guides && data.guides.length > 0) {
                detailsHtml += '<h4>Guides in School (Visual vs Actual):</h4>';
                const subjects = {};
                data.guides.forEach(guide => {
                    if (guide.type !== 'header') {  // Skip header objects
                        if (!subjects[guide.subject]) {
                            subjects[guide.subject] = {
                                visual: 0,
                                total: guide.totalCount || 0
                            };
                        }
                        subjects[guide.subject].visual++;
                    }
                });
                Object.entries(subjects).forEach(([subject, info]) => {
                    detailsHtml += `
                        <div class="data-item">
                            <span class="data-label">${subject.toUpperCase()}:</span> 
                            <span class="data-value">${info.visual} shown / ${info.total} total</span>
            </div>
                    `;
                });
            }
            
            document.getElementById('details').innerHTML = detailsHtml;
        });
        
        // Handle window resize
        window.addEventListener('resize', onWindowResize, false);
        
        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        
        // Mouse controls for camera
        let mouseDown = false;
        let mouseX = 0, mouseY = 0;
        
        document.addEventListener('mousedown', function(event) {
            mouseDown = true;
            mouseX = event.clientX;
            mouseY = event.clientY;
        });
        
        document.addEventListener('mouseup', function(event) {
            mouseDown = false;
        });
        
        document.addEventListener('mousemove', function(event) {
            if (mouseDown) {
                const deltaX = event.clientX - mouseX;
                const deltaY = event.clientY - mouseY;
                
                // Smoother camera movement with reduced sensitivity
                camera.position.x += deltaX * 0.05;  // Reduced from 0.1
                camera.position.y -= deltaY * 0.05;  // Reduced from 0.1
                camera.lookAt(0, 0, 0);
                
                mouseX = event.clientX;
                mouseY = event.clientY;
            }
        });
        
        // Mouse wheel for zoom with smoother control
        document.addEventListener('wheel', function(event) {
            const zoomSpeed = 0.05;  // Reduced from 0.1
            camera.position.z += event.deltaY * zoomSpeed;
            camera.lookAt(0, 0, 0);
        });
        
        // Initialize the scene
        init();
    </script>
</body>
</html> 